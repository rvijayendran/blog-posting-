{% extends "base.html" %}
{% load static %}

{% block css_style %}
    <link rel="stylesheet" href="{% static 'post/css files/post.css' %}">
{% endblock %}

{% block content_page %}
{% include "post/includes/headers.html" %}
<main class="container">
    <article class="post-full">
        <header class="post-header">
            <h1 class="post-title">{{ posts.title|title }}</h1>
            <div class="post-meta">
                <span class="author">By {{ posts.author_name.first_name }}</span>
                <span class="date">on {{ posts.date|date:"F j, Y" }}</span>
            </div>
        </header>

        <figure class="post-image">
            <img src="{{ posts.image_name.url }}" alt="{{ posts.title }}">
        </figure>
        
        <section class="post-content">
            <div class="post-body">
                {{ posts.content|linebreaks }}
            </div>
            
            {% if posts.caption.all %}
            <ul class="caption-list">
                {% for caption in posts.caption.all %}
                <li class="caption-badge">{{ caption }}</li>
                {% endfor %}
            </ul>
            {% endif %}
            
            <section class="comments-section">
                <h3>Comments</h3>
                
                {% if user.is_authenticated %}
                <div class="comment-form">
                    <h4>Leave a Comment</h4>
                    <form action="{% url 'post' posts.title %}" method="POST" class="comment-form">
                        {% csrf_token %}
                        <div class="form-group">
                            {{ comments }}
                        </div>
                        <button type="submit" class="btn">Post Comment</button>
                    </form>
                </div>
                {% else %}
                <p><a href="{% url 'login' %}" class="btn">Log in to leave a comment</a></p>
                {% endif %}
                
                {% if list_comments %}
                <ul class="comment-list">
                    {% for comment in list_comments %}
                    <li class="comment-item">
                        <div class="comment-meta">
                            <span class="comment-author">{{ comment.name }}</span>
                            <span class="comment-date">{{ comment.created_at|timesince }} ago</span>
                        </div>
                        <div class="comment-content">
                            {{ comment.comments }}
                        </div>
                    </li>
                    {% endfor %}
                </ul>
                {% else %}
                <p class="no-comments">No comments yet. Be the first to comment!</p>
                {% endif %}
            </section>                                                                                
        <div class="post-actions">
            <form action="{% url 'addme' %}" method="POST" class="read-later-form">
                {% csrf_token %}
                <input type="hidden" name="readlater_id" value="{{ posts.id }}">
                <button type="submit" class="btn-read-later" aria-label="Save to Read Later">
                    <span class="btn-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M19 21l-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z"></path>
                        </svg>
                    </span>
                    <span class="btn-text">Read Later</span>
                </button>
            </form>
        </div>
    </article>
</main>
{% endblock %}